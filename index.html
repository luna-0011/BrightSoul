<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Wisdom</title>
  <meta name="theme-color" content="#bfdbfe" />
  <style>
    :root{
      --bg:#f7f7fb;
      --text:#111827;
      --muted:#4b5563;
      --border:rgba(17,24,39,.15);
      --deck-bg:#E8F1FF;
      --deck-border:#5B7DBA;
      --danger-bg: rgba(239, 68, 68, .10);
      --danger-border: rgba(239, 68, 68, .35);
      --danger-text: rgba(127, 29, 29, 1);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(147,197,253,.35), transparent 60%),
        radial-gradient(900px 600px at 90% 15%, rgba(167,243,208,.28), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .hero{padding:20px 18px; border-bottom:1px solid var(--border)}
    .hero-inner{max-width:1100px; margin:0 auto;}
    .topbar{display:flex; gap:18px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap}
    .hero-title{margin:0; font-size:32px}
    .hero-subtitle{margin:6px 0 0; color:var(--muted)}
    .lang-label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    .lang-select{
      padding:10px 12px; border-radius:12px; border:1px solid var(--border);
      background:rgba(255,255,255,.75); color:var(--text)
    }
    .main{max-width:1100px; margin:0 auto; padding:18px; display:grid; gap:18px}
    .deck{
      border:1px solid var(--border);
      border-radius:18px;
      padding:16px;
      background:rgba(255,255,255,.55);
      backdrop-filter: blur(6px);
    }
    .deck-head{display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap}
    .controls{display:flex; gap:10px}
    .btn{
      border:1px solid var(--border);
      background:rgba(255,255,255,.75);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    .btn:hover{background:rgba(255,255,255,.92)}
    .btn:disabled{opacity:.45; cursor:not-allowed}
    .btn.primary{background:rgba(17,24,39,.06); border-color:rgba(17,24,39,.18)}
    .btn.primary:hover{background:rgba(17,24,39,.09)}
    .deck-card{margin-top:14px; display:flex; justify-content:center}

    /* Error bar */
    .errorbar{
      margin-top:14px;
      border:1px solid var(--danger-border);
      background: var(--danger-bg);
      border-radius:14px;
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .errorbar-text{color:var(--danger-text); font-size:13px; line-height:1.3}
    .errorbar-actions{display:flex; gap:8px}
    .errorbar .btn{padding:8px 10px}

    /* Flashcard */
    .flashcard{width:min(680px, 100%); height:300px; perspective:1200px}
    .flashcard-inner{
      position:relative; width:100%; height:100%;
      transform-style:preserve-3d;
      transition:transform .55s cubic-bezier(.2,.8,.2,1);
    }
    .flashcard.is-flipped .flashcard-inner{transform:rotateY(180deg)}
    .flash-side{
      position:absolute; inset:0;
      border-radius:18px;
      backface-visibility:hidden; -webkit-backface-visibility:hidden;
      overflow:hidden;
      display:flex; flex-direction:column; justify-content:space-between;
      padding:16px;
    }
    .flash-front{
      background: var(--deck-bg);
      border:2px solid var(--deck-border);
      text-align:center;
    }
    .front-center{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:8px 18px;
    }
    .front-center-block{max-width:520px}
    .front-center-title{font-weight:800; font-size:26px; line-height:1.1; margin:0;}
    .front-center-subtitle{font-weight:700; font-size:15px; margin:8px 0 0;}
    .front-center-quote{
      margin:10px 0 0;
      font-size:12px;
      font-style:italic;
      font-weight:400;
      color:rgba(17,24,39,.75);
      line-height:1.35;
    }
    .front-footer{display:flex; justify-content:space-between; font-size:12px; color:rgba(17,24,39,.60)}
    .flash-back{
      background:#fff;
      border:2px solid var(--deck-border);
      transform:rotateY(180deg);
    }
    .back-heading{margin:10px 0 10px; font-size:18px; text-align:center}
    .back-body{margin:0; white-space:pre-wrap; text-align:center; overflow:auto; flex:1; line-height:1.45}
    .meta{display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; font-size:12px; color:rgba(17,24,39,.55)}
    .footer{border-top:1px solid var(--border); padding:18px; color:var(--muted); text-align:center}

    /* Topics */
    .topics{margin-top:16px; border-top:1px dashed var(--border); padding-top:14px}
    .topics-title{margin:0 0 10px; font-size:14px; color:var(--muted)}
    .topics-links{display:flex; gap:10px; flex-wrap:wrap}
    .topic-link{
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.65);
      color:var(--text);
      text-decoration:none;
      font-size:13px;
    }
    .topic-link:hover{background:rgba(255,255,255,.9)}

    /* RTL */
    html[dir="rtl"] body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Naskh Arabic", "Amiri", sans-serif;}
    html[dir="rtl"] .controls{flex-direction:row-reverse}
    html[dir="rtl"] .topbar{flex-direction:row-reverse}
    html[dir="rtl"] .topics-links{flex-direction:row-reverse}
  </style>
</head>
<body>
  <header class="hero">
    <div class="hero-inner">
      <div class="topbar">
        <div class="brand">
          <h1 class="hero-title" data-i18n="app_title">Daily Wisdom</h1>
          <p class="hero-subtitle" data-i18n="app_subtitle">Sayings of The Prophet Muhammad ï·º</p>
        </div>
        <div class="lang">
          <label for="langSelect" class="lang-label" data-i18n="language_label">Language</label>
          <select id="langSelect" class="lang-select" aria-label="Select language">
            <option value="en">English</option>
            <option value="it">Italiano</option>
            <option value="fr">FranÃ§ais</option>
            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          </select>
        </div>
      </div>

      <div id="errorBar" class="errorbar" hidden>
        <div class="errorbar-text" id="errorText">Error</div>
        <div class="errorbar-actions">
          <a class="btn" id="reportLink" href="#" target="_blank" rel="noopener">Report</a>
          <button class="btn" id="dismissError" type="button">Ã—</button>
        </div>
      </div>
    </div>
  </header>

  <main class="main">
    <section class="deck" aria-labelledby="deck-title">
      <div class="deck-head">
        <h2 id="deck-title" data-i18n="deck_title">Prophet Muhammad ï·º</h2>
        <div class="controls">
          <button type="button" class="btn" data-action="prev" data-i18n-btn="btn_prev">â—€</button>
          <button type="button" class="btn primary" data-action="today" data-i18n-btn="btn_today">ğŸ“…</button>
          <button type="button" class="btn" data-action="next" data-i18n-btn="btn_next">â–¶</button>
        </div>
      </div>

      <div class="deck-card" id="deck-profeta" aria-live="polite"></div>

      <nav class="topics" aria-label="Other topics">
        <h3 class="topics-title" data-i18n="topics_title">Other topics</h3>
        <div class="topics-links">
          <!-- placeholder links -->
          <a class="topic-link" href="#" onclick="alert('Coming soon'); return false;" data-i18n="topic_parables">Parables</a>
          <a class="topic-link" href="#" onclick="alert('Coming soon'); return false;" data-i18n="topic_science">Science</a>
          <a class="topic-link" href="#" onclick="alert('Coming soon'); return false;" data-i18n="topic_gratitude">Gratitude</a>
        </div>
      </nav>
    </section>
  </main>

  <footer class="footer">
    <p data-i18n="footer_body">Single-file build (no fetch).</p>
  </footer>

  <script>
    function qs(sel, root=document){ return root.querySelector(sel); }

    const REF = "Reference (Daily Wisdom - A.R.Kidwai)";

    // --- Data: first 8 translated + placeholders to 365 ---
    const DATA = {
      en: {
        profeta: [
          "God has sent me to profess and practise moral values and deeds.",
          "O God! Purify my heart of hypocrisy, my actions of pretence, my tongue of lies, and my eyes of deception. For You know well the deception of the eye and all that is concealed in the heart.",
          "Avoid suspicion, for suspicion is often baseless. Do not spy on each other. Do not probe into the affairs of others. Nor indulge in worldliness or jealousy. Do not bear grudges against each other. Nor betray anyone. Rather lead your lives as servants of God and live as brothers.",
          "In both your private and public life you should always fear God. Piety should inform your conduct. Your good deeds will help in getting your sins forgiven. Treat people well.",
          "Anyone who has these three traits is definitely a hypocrite: 1 - he tells a lie whenever he says something; 2 - he does not keep his word whenever he makes a promise; and 3 - he cheats when a trust is placed in his care.",
          "Follow the middle path. Taking up what is beyond your capacity will only bring shame upon you.",
          "I have little to do with this world. My worldly life is no more than the halting of a traveller, taking rest under the shade of a tree for a moment and then moving on.",
          "The Prophet was never seen eating while reclining against a cushion. Nor did he let anyone walk behind him."
        ]
      },
      it: {
        profeta: [
          "Dio mi ha inviato per proclamare e mettere in pratica valori e azioni morali.",
          "O Dio! Purifica il mio cuore dallâ€™ipocrisia, le mie azioni dallâ€™ostentazione, la mia lingua dalla menzogna e i miei occhi dallâ€™inganno. Tu conosci bene lâ€™inganno dello sguardo e ciÃ² che Ã¨ nascosto nel cuore.",
          "Evita i sospetti, perchÃ© spesso sono infondati. Non spiarti a vicenda. Non indagare negli affari altrui. Non indulgere in mondanitÃ  o gelosia. Non serbare rancore. Non tradire nessuno. Vivete piuttosto come servi di Dio e come fratelli.",
          "Sia nella vita privata sia in quella pubblica, temete sempre Dio. La pietÃ  guidi la vostra condotta. Le buone azioni aiuteranno a farvi perdonare i peccati. Trattate bene le persone.",
          "Chi possiede questi tre tratti Ã¨ certamente un ipocrita: 1) mente quando parla; 2) non mantiene la parola quando promette; 3) tradisce la fiducia quando gli viene affidato un incarico.",
          "Segui la via di mezzo. Assumerti ciÃ² che Ã¨ oltre le tue capacitÃ  ti porterÃ  solo vergogna.",
          "Ho poco a che fare con questo mondo. La mia vita terrena non Ã¨ che la sosta di un viandante, che riposa un momento allâ€™ombra di un albero e poi riparte.",
          "Il Profeta non fu mai visto mangiare appoggiato a un cuscino, nÃ© permetteva a qualcuno di camminare dietro di lui."
        ]
      },
      fr: {
        profeta: [
          "Dieu mâ€™a envoyÃ© pour proclamer et mettre en pratique les valeurs et les actes moraux.",
          "Ã” Dieu ! Purifie mon cÅ“ur de lâ€™hypocrisie, mes actes de lâ€™ostentation, ma langue du mensonge et mes yeux de la tromperie. Tu connais bien la tromperie du regard et tout ce qui est cachÃ© dans le cÅ“ur.",
          "Ã‰vitez les soupÃ§ons, car ils sont souvent sans fondement. Ne vous espionnez pas. Ne fouillez pas dans les affaires des autres. Ne cÃ©dez ni au matÃ©rialisme ni Ã  la jalousie. Ne gardez pas de rancune. Ne trahissez personne. Vivez plutÃ´t comme des serviteurs de Dieu et comme des frÃ¨res.",
          "Dans votre vie privÃ©e comme dans votre vie publique, craignez toujours Dieu. Que la piÃ©tÃ© guide votre conduite. Vos bonnes actions aideront au pardon de vos pÃ©chÃ©s. Traitez bien les gens.",
          "Quiconque possÃ¨de ces trois traits est assurÃ©ment un hypocrite : 1) il ment lorsquâ€™il parle ; 2) il ne tient pas sa parole lorsquâ€™il promet ; 3) il trahit la confiance lorsquâ€™on lui confie un dÃ©pÃ´t.",
          "Suivez la voie du juste milieu. Vouloir porter au-delÃ  de vos capacitÃ©s ne vous apportera que la honte.",
          "Jâ€™ai peu Ã  voir avec ce monde. Ma vie ici-bas nâ€™est que lâ€™arrÃªt dâ€™un voyageur qui se repose un instant Ã  lâ€™ombre dâ€™un arbre puis reprend sa route.",
          "On nâ€™a jamais vu le ProphÃ¨te manger en sâ€™adossant Ã  un coussin. Et il ne laissait pas quelquâ€™un marcher derriÃ¨re lui."
        ]
      },
      ar: {
        profeta: [
          "Ø¥Ù†Ù‘Ù Ø§Ù„Ù„Ù‡Ù Ø£Ø±Ø³Ù„Ù†ÙŠ Ù„Ø£ÙØ¹Ù„ÙÙ†Ù ÙˆØ£ÙØ·Ø¨Ù‘ÙÙ‚Ù Ø§Ù„Ù‚ÙŠÙ…Ù ÙˆØ§Ù„Ø£Ø¹Ù…Ø§Ù„Ù Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ÙŠØ©Ù.",
          "Ø§Ù„Ù„Ù‡Ù… Ø·Ù‡Ù‘ÙØ± Ù‚Ù„Ø¨ÙŠ Ù…Ù† Ø§Ù„Ù†ÙØ§Ù‚ØŒ ÙˆØ£Ø¹Ù…Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø±ÙŠØ§Ø¡ØŒ ÙˆÙ„Ø³Ø§Ù†ÙŠ Ù…Ù† Ø§Ù„ÙƒØ°Ø¨ØŒ ÙˆØ¹ÙŠÙ†ÙŠ Ù…Ù† Ø§Ù„Ø®Ø¯Ø§Ø¹Ø› ÙØ¥Ù†Ùƒ ØªØ¹Ù„Ù… Ø®Ø§Ø¦Ù†Ø© Ø§Ù„Ø£Ø¹ÙŠÙ† ÙˆÙ…Ø§ ØªÙØ®ÙÙŠ Ø§Ù„ØµØ¯ÙˆØ±.",
          "Ø¥ÙŠØ§ÙƒÙ… ÙˆØ§Ù„Ø¸Ù†Ù‘Ù ÙØ¥Ù† Ø§Ù„Ø¸Ù†Ù‘Ù ÙƒØ«ÙŠØ±Ù‹Ø§ Ù…Ø§ ÙŠÙƒÙˆÙ† Ø¨Ù„Ø§ Ø£Ø³Ø§Ø³. ÙˆÙ„Ø§ ØªØ¬Ø³Ù‘ÙØ³ÙˆØ§ Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶ÙƒÙ…ØŒ ÙˆÙ„Ø§ ØªØªØ¨Ù‘ÙØ¹ÙˆØ§ Ø¹ÙˆØ±Ø§Øª Ø§Ù„Ù†Ø§Ø³. ÙˆÙ„Ø§ ØªÙ†ØºÙ…Ø³ÙˆØ§ ÙÙŠ Ø§Ù„Ø¯Ù†ÙŠØ§ Ø£Ùˆ ÙÙŠ Ø§Ù„Ø­Ø³Ø¯. ÙˆÙ„Ø§ ØªØ­Ù‚Ø¯ÙˆØ§ØŒ ÙˆÙ„Ø§ ØªØ®ÙˆÙ†ÙˆØ§ Ø£Ø­Ø¯Ù‹Ø§. Ø¨Ù„ ÙƒÙˆÙ†ÙˆØ§ Ø¹Ø¨Ø§Ø¯Ù Ø§Ù„Ù„Ù‡ ÙˆØ¥Ø®ÙˆØ©Ù‹.",
          "ÙÙŠ Ø­ÙŠØ§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© ÙˆØ§Ù„Ø¹Ø§Ù…Ø© Ø®ÙÙÙ Ø§Ù„Ù„Ù‡Ù Ø¯Ø§Ø¦Ù…Ù‹Ø§. ÙˆÙ„ØªÙƒÙ† Ø§Ù„ØªÙ‚ÙˆÙ‰ Ù…Ø¹ÙŠØ§Ø±Ù Ø³Ù„ÙˆÙƒÙƒ. Ø¥Ù† Ø£Ø¹Ù…Ø§Ù„Ùƒ Ø§Ù„ØµØ§Ù„Ø­Ø© ØªØ¹ÙŠÙ† Ø¹Ù„Ù‰ Ù…ØºÙØ±Ø© Ø°Ù†ÙˆØ¨Ùƒ. ÙˆØ£Ø­Ø³Ù† Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø§Ø³.",
          "Ù…Ù† ÙƒØ§Ù†Øª ÙÙŠÙ‡ Ù‡Ø°Ù‡ Ø§Ù„Ø®ØµØ§Ù„ Ø§Ù„Ø«Ù„Ø§Ø« ÙÙ‡Ùˆ Ù…Ù†Ø§ÙÙ‚ Ù‚Ø·Ø¹Ù‹Ø§: (1) Ø¥Ø°Ø§ Ø­Ø¯Ù‘ÙØ« ÙƒØ°Ø¨ØŒ (2) ÙˆØ¥Ø°Ø§ ÙˆØ¹Ø¯ Ø£Ø®Ù„ÙØŒ (3) ÙˆØ¥Ø°Ø§ Ø§Ø¤ØªÙ…Ù† Ø®Ø§Ù†.",
          "Ø§Ù„Ø²Ù… Ø·Ø±ÙŠÙ‚ Ø§Ù„ÙˆØ³Ø·. ÙØ¥Ù† ØªØ­Ù…Ù‘ÙÙ„ Ù…Ø§ Ù‡Ùˆ ÙÙˆÙ‚ Ø·Ø§Ù‚ØªÙƒ Ù„Ø§ ÙŠØ¬Ù„Ø¨ Ù„Ùƒ Ø¥Ù„Ø§ Ø§Ù„Ø®Ø²ÙŠ.",
          "Ù„ÙŠØ³ Ù„ÙŠ Ù…Ù† Ø§Ù„Ø¯Ù†ÙŠØ§ Ø¥Ù„Ø§ Ø§Ù„Ù‚Ù„ÙŠÙ„. Ø¥Ù†Ù…Ø§ Ø­ÙŠØ§ØªÙŠ ÙÙŠÙ‡Ø§ ÙƒÙ…Ø³Ø§ÙØ±Ù Ø§Ø³ØªØ¸Ù„Ù‘Ù Ø¨Ø¸Ù„Ù‘Ù Ø´Ø¬Ø±Ø©Ù Ù„Ø­Ø¸Ø©Ù‹ Ø«Ù… Ù…Ø¶Ù‰.",
          "Ù…Ø§ Ø±ÙØ¦ÙŠ Ø§Ù„Ù†Ø¨ÙŠÙ‘Ù ÙŠØ£ÙƒÙ„ Ù…ØªÙƒØ¦Ù‹Ø§ Ø¹Ù„Ù‰ ÙˆØ³Ø§Ø¯Ø©ØŒ ÙˆÙ„Ø§ ÙƒØ§Ù† ÙŠØ¯Ø¹ Ø£Ø­Ø¯Ù‹Ø§ ÙŠÙ…Ø´ÙŠ Ø®Ù„ÙÙ‡."
        ]
      }
    };

    // pad to 365
    for (const lang of Object.keys(DATA)) {
      while (DATA[lang].profeta.length < 365) DATA[lang].profeta.push("â€”");
    }

    const I18N = {
      en:{ dir:"ltr", app_title:"Daily Wisdom", app_subtitle:"Sayings of The Prophet Muhammad ï·º", deck_title:"Prophet Muhammad ï·º",
        language_label:"Language", btn_prev:"Back", btn_today:"Today", btn_next:"Next", flip:"Tap to flip",
        footer_body:"Single-file build (no fetch).",
        topics_title:"Other topics", topic_parables:"Parables", topic_science:"Science", topic_gratitude:"Gratitude",
        report_btn:"Report", error_loading:"Something went wrong.", error_console:"Open the browser console for details.",
        front_title:"Daily Wisdom", front_subtitle:"Sayings of The Prophet Muhammad ï·º",
        front_quote:"There is an excellent example (of conduct) for you in Prophet Muhammad, the Messenger of God. [ Qurâ€™an 33:21 ]"
      },
      it:{ dir:"ltr", app_title:"Saggezza del giorno", app_subtitle:"Detti del Profeta Muhammad ï·º", deck_title:"Profeta Muhammad ï·º",
        language_label:"Lingua", btn_prev:"Indietro", btn_today:"Oggi", btn_next:"Avanti", flip:"Tocca per girare",
        footer_body:"Versione in un solo file (senza fetch).",
        topics_title:"Altri temi", topic_parables:"Parabole", topic_science:"Scienza", topic_gratitude:"Gratitudine",
        report_btn:"Segnala", error_loading:"Qualcosa Ã¨ andato storto.", error_console:"Apri la console del browser per i dettagli.",
        front_title:"Daily Wisdom", front_subtitle:"Sayings of The Prophet Muhammad ï·º",
        front_quote:"Câ€™Ã¨ per voi un eccellente esempio nel Profeta Muhammad, il Messaggero di Dio. [ Corano 33:21 ]"
      },
      fr:{ dir:"ltr", app_title:"Sagesse du jour", app_subtitle:"Paroles du ProphÃ¨te Muhammad ï·º", deck_title:"ProphÃ¨te Muhammad ï·º",
        language_label:"Langue", btn_prev:"Retour", btn_today:"Aujourdâ€™hui", btn_next:"Suivant", flip:"Touchez pour retourner",
        footer_body:"Version mono-fichier (sans fetch).",
        topics_title:"Autres thÃ¨mes", topic_parables:"Paraboles", topic_science:"Science", topic_gratitude:"Gratitude",
        report_btn:"Signaler", error_loading:"Un problÃ¨me est survenu.", error_console:"Ouvrez la console du navigateur pour les dÃ©tails.",
        front_title:"Daily Wisdom", front_subtitle:"Sayings of The Prophet Muhammad ï·º",
        front_quote:"Il y a pour vous un excellent exemple dans Muhammad, le Messager de Dieu. [ Coran 33:21 ]"
      },
      ar:{ dir:"rtl", app_title:"Ø­ÙÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ…", app_subtitle:"Ø£Ù‚ÙˆØ§Ù„ Ø§Ù„Ù†Ø¨ÙŠ Ù…Ø­Ù…Ø¯ ï·º", deck_title:"Ø§Ù„Ù†Ø¨ÙŠ Ù…Ø­Ù…Ø¯ ï·º",
        language_label:"Ø§Ù„Ù„ØºØ©", btn_prev:"Ø§Ù„Ø³Ø§Ø¨Ù‚", btn_today:"Ø§Ù„ÙŠÙˆÙ…", btn_next:"Ø§Ù„ØªØ§Ù„ÙŠ", flip:"Ø§Ø¶ØºØ· Ù„Ù‚Ù„Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©",
        footer_body:"Ù†Ø³Ø®Ø© Ø¨Ù…Ù„Ù ÙˆØ§Ø­Ø¯ (Ø¨Ø¯ÙˆÙ† fetch).",
        topics_title:"Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø£Ø®Ø±Ù‰", topic_parables:"Ø£Ù…Ø«Ø§Ù„", topic_science:"Ø¹Ù„Ù…", topic_gratitude:"Ø§Ù…ØªÙ†Ø§Ù†",
        report_btn:"Ø¥Ø¨Ù„Ø§Øº", error_loading:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ù…Ø§.", error_console:"Ø§ÙØªØ­ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ù„ØªÙØ§ØµÙŠÙ„.",
        front_title:"Daily Wisdom", front_subtitle:"Sayings of The Prophet Muhammad ï·º",
        front_quote:"Ù„ÙÙ‚ÙØ¯Ù’ ÙƒÙØ§Ù†Ù Ù„ÙÙƒÙÙ…Ù’ ÙÙÙŠ Ø±ÙØ³ÙÙˆÙ„Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø£ÙØ³Ù’ÙˆÙØ©ÙŒ Ø­ÙØ³ÙÙ†ÙØ©ÙŒ. [ Ø§Ù„Ø£Ø­Ø²Ø§Ø¨ 33:21 ]"
      }
    };

    let currentLang = "en";
    let bag = [];
    let seen = [];
    let cursor = -1;

    const STORAGE_KEY = (lang)=>`dw_singlefile_state_${lang}`;

    function t(key){
      const d = I18N[currentLang] || I18N.en;
      return d[key] ?? key;
    }

    function applyTranslations(){
      const d = I18N[currentLang] || I18N.en;
      document.documentElement.lang = currentLang;
      document.documentElement.dir  = d.dir || "ltr";

      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const k = el.getAttribute("data-i18n");
        el.textContent = t(k);
      });
      document.querySelectorAll("[data-i18n-btn]").forEach(el=>{
        const k = el.getAttribute("data-i18n-btn");
        el.textContent = t(k);
      });

      const report = qs("#reportLink");
      if(report) report.textContent = t("report_btn");
    }

    function shuffle(arr){
      const a = [...arr];
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    function saveState(){
      try{
        localStorage.setItem(STORAGE_KEY(currentLang), JSON.stringify({bag, seen, cursor}));
      }catch(_){}
    }
    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY(currentLang));
        if(!raw) return false;
        const s = JSON.parse(raw);
        if(!Array.isArray(s.bag) || !Array.isArray(s.seen) || typeof s.cursor!=="number") return false;
        bag = s.bag; seen = s.seen; cursor = s.cursor;
        return true;
      }catch(_){ return false; }
    }

    function escapeHtml(str){
      return String(str??"")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }

    function showError(message, detail){
      const bar = qs("#errorBar");
      const text = qs("#errorText");
      const report = qs("#reportLink");
      if(!bar || !text || !report) return;

      const info = [
        `lang=${currentLang}`,
        `url=${location.href}`,
        `ua=${navigator.userAgent}`,
        detail ? `detail=${detail}` : ""
      ].filter(Boolean).join("\\n");

      text.textContent = `${message} ${t("error_console")}`;
      const subject = encodeURIComponent("Daily Wisdom â€” error report");
      const body = encodeURIComponent(`${message}\\n\\n${info}`);
      report.href = `mailto:?subject=${subject}&body=${body}`;
      bar.hidden = false;
    }
    function hideError(){ const bar = qs("#errorBar"); if(bar) bar.hidden = true; }

    function refillBag(total){
      bag = shuffle([...Array(total)].map((_,i)=>i));
    }

    function render(cardIndex){
      const mount = qs("#deck-profeta");
      if(!mount) return;

      const list = DATA[currentLang]?.profeta || [];
      const total = list.length || 365;

      const body = list[cardIndex] ?? "â€”";
      const progress = (cursor >= 0) ? `${cursor+1}/${total}` : `0/${total}`;

      mount.innerHTML = `
        <div class="flashcard" role="button" tabindex="0" aria-label="${escapeHtml(t("flip"))}">
          <div class="flashcard-inner">
            <div class="flash-side flash-front">
              <div class="front-center">
                <div class="front-center-block">
                  <h3 class="front-center-title">${escapeHtml(t("front_title"))}</h3>
                  <div class="front-center-subtitle">${escapeHtml(t("front_subtitle"))}</div>
                  <div class="front-center-quote">${escapeHtml(t("front_quote"))}</div>
                </div>
              </div>
              <div class="front-footer">
                <span>${escapeHtml(t("flip"))}</span>
                <span>${escapeHtml(progress)}</span>
              </div>
            </div>

            <div class="flash-side flash-back">
              <div>
                <div class="back-heading"></div>
                <p class="back-body">${escapeHtml(body)}</p>
              </div>
              <div class="meta">
                <span>${escapeHtml(REF)}</span>
                <span>${escapeHtml(progress)}</span>
              </div>
            </div>
          </div>
        </div>
      `;

      const fc = mount.querySelector(".flashcard");
      const flip = ()=>fc.classList.toggle("is-flipped");
      fc.addEventListener("click", flip);
      fc.addEventListener("keydown", (e)=>{
        if(e.key==="Enter"||e.key===" "){ e.preventDefault(); flip(); }
      });
    }

    function updateControls(){
      const prevBtn = qs('button[data-action="prev"]');
      const nextBtn = qs('button[data-action="next"]');
      if(prevBtn) prevBtn.disabled = (cursor <= 0);
      if(nextBtn) nextBtn.disabled = (cursor >= seen.length - 1);
    }

    function drawRandom(){
      const list = DATA[currentLang]?.profeta || [];
      const total = list.length || 365;
      if(!total) return;

      if(!bag.length){
        refillBag(total);
        seen = [];
        cursor = -1;
      }

      const idx = bag.pop();

      if(cursor < seen.length - 1) seen = seen.slice(0, cursor + 1);

      seen.push(idx);
      cursor = seen.length - 1;

      render(idx);
      updateControls();
      saveState();
    }

    function showPrev(){
      if(cursor <= 0) return;
      cursor--;
      render(seen[cursor]);
      updateControls();
      saveState();
    }
    function showNext(){
      if(cursor >= seen.length - 1) return;
      cursor++;
      render(seen[cursor]);
      updateControls();
      saveState();
    }

    function init(){
      hideError();
      try{
        const sel = qs("#langSelect");
        currentLang = sel?.value || "en";
        applyTranslations();

        bag = []; seen = []; cursor = -1;
        const restored = loadState();

        const total = (DATA[currentLang]?.profeta || []).length || 365;
        const ok = restored && (bag.length + seen.length === total);

        if(!ok){
          refillBag(total);
          drawRandom();
        }else{
          if(cursor >= 0 && seen[cursor] != null){
            render(seen[cursor]);
            updateControls();
          }else{
            drawRandom();
          }
        }

        sel?.addEventListener("change", ()=>{
          currentLang = sel.value;
          applyTranslations();
          // reset per-language session
          bag = []; seen = []; cursor = -1;
          if(!loadState()){
            refillBag((DATA[currentLang]?.profeta||[]).length||365);
            drawRandom();
          }else{
            const total2 = (DATA[currentLang]?.profeta || []).length || 365;
            const ok2 = (bag.length + seen.length === total2);
            if(!ok2){
              refillBag(total2);
              drawRandom();
            }else{
              render(seen[cursor] ?? 0);
              updateControls();
            }
          }
        });

        qs("#dismissError")?.addEventListener("click", hideError);

        document.addEventListener("click", (e)=>{
          const btn = e.target.closest("button[data-action]");
          if(!btn) return;
          const action = btn.getAttribute("data-action");
          if(action === "prev") showPrev();
          if(action === "next") showNext();
          if(action === "today") drawRandom();
        });

      }catch(err){
        console.error(err);
        showError(t("error_loading"), err?.message || String(err));
      }
    }

    window.addEventListener("error", (e)=>{
      showError("Something went wrong.", e?.message || "runtime error");
    });
    window.addEventListener("unhandledrejection", (e)=>{
      showError("Something went wrong.", e?.reason?.message || String(e?.reason || "promise rejection"));
    });

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
